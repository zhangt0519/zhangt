var TabPanel=function(){};(function(c){var j,r={},q={},b=0,e={header:[],body:[]};var p,g,m;var f=function(s,t){return s.replace(/\{([^}]+)\}/g,function(v,u){return t[u]||""})};var n=c.browser.msie&&c.browser.version=="6.0";var h=function(s){return !isNaN(parseInt(s))?parseInt(s):0};var d=function(s){return h(s.css("margin-top"))+h(s.css("margin-bottom"))+h(s.css("border-top-width"))+h(s.css("border-bottom-width"))};var l=function(s){return h(s.css("margin-left"))+h(s.css("margin-right"))+h(s.css("border-right-width"))+h(s.css("border-left-width"))};var a=document.getElementsByTagName("script");var k=a[a.length-1];var i=k.src.substring(0,k.src.lastIndexOf("/")+1);var o=function(){while(parseInt(p.attr("iw"))>parseInt(p.attr("w"))){this.removeTab(r.owIndex)}};TabPanel=function(x,u){j=c(x);var t={max:-1,defaultIcon:null,showClose:false,owIndex:1,blankImg:i+"skin/blank.gif",tpl:{hd:'<li id="{id}" class="{closeCls}"><s class="il"></s><s class="ir"></s>{icon}{title}{closeicon}</li>',bd:'<iframe src="{url}" frameborder="0" scrolling="auto" border="0" id="{id}_body"></iframe>'}};if(!j.length||!j[0].nodeType){return alert("\u65e0\u6cd5\u6e32\u67d3\uff0c\u5bb9\u5668\u4e0d\u5b58\u5728\uff01")}r=c.extend(t,u);if(isNaN(parseInt(r.max))){r.max=t.max}if(!r.tpl||!r.hd||!r.bd){r.tpl=t.tpl}if(isNaN(parseInt(r.owIndex))){r.owIndex=t.owIndex}r.owIndex=Math.min(Math.max(r.owIndex,0),r.max-1);j.addClass("tabpanel");var s=c('<div class="tab-header"><s class="l"></s><s class="r"></s><ul></ul></div>').appendTo(j);p=s.find("ul").eq(0);p.attr("w",p.width());p.attr("iw",0);g=c('<div class="tab-body"></div>').appendTo(j);p.click(c.proxy(this.headerClick,this));var v=d(s)+s.height()+d(g);g.height(j.height()-v);var w=this;c(window).resize(function(){p.attr("w",p.width());o.call(w);g.hide().height(j.height()-v).show()})};TabPanel.prototype={showTab:function(s,t){this.hasTab(s)?this.activeTab(s,t):this.addTab(s);return this},activeTab:function(t,u){var y=this.getId(t);c.each(e.header,function(){this.removeClass("active")});var w=c("#"+y).addClass("active");c.each(e.body,function(){this.css("display","none")});var v=c("#"+y+"_body").css("display","block");if(u){var s=v.get(0),x=s.src;s.src="javascript:false";s.src=t.url||x}if(c.isFunction(r.onActive)){r.onActive.apply(this,[y,w,v])}return this},addTab:function(s){if(parseInt(r.max)>0&&b>=parseInt(r.max)){this.removeTab(r.owIndex)}var z=this.getId(s);var t=s.icon||r.defaultIcon;t=n?"<img src='"+r.blankImg+"' style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='image', src='"+t+"')\" />":"<img src='"+t+"' />";var w=s.showClose==undefined?r.showClose:s.showClose;var y=w?"<s class='close' title='\u5173\u95ed'>\u5173\u95ed</s>":"";var v=c.extend(s,{id:z,icon:t,closeicon:y,closeCls:w?"closeCls":""});var x,u;e.header.push(x=c(f(r.tpl.hd,v)).appendTo(p));e.body.push(u=c(f(r.tpl.bd,v)).appendTo(g));b++;p.attr("iw",parseInt(p.attr("iw"))+parseInt(x.attr("w",x.outerWidth()+l(x)).attr("w")));o.call(this);this.activeTab(s);if(c.isFunction(r.onAdd)){r.onAdd.apply(this,[z,x,u])}return this},removeTab:function(t,s){if(!e.header[t]){return}this.fixIFrame(e.body[t]);var x=e.header[t].remove();var u=e.body[t].remove();p.attr("iw",p.attr("iw")-x.attr("w"));e.header.splice(t,1);e.body.splice(t,1);--b;try{CollectGarbage()}catch(w){}if(c.isFunction(r.onRemove)){r.onRemove.apply(this,[x.attr("id"),x,u])}if(s){var v=(t==b)?t-1:t;this.activeTab(e.header[v].attr("id"))}return this},hasTab:function(s){return c("#"+this.getId(s)).length},getId:function(s){if(s.id){return s.id}if(!s||!s.url||typeof s=="string"){return s||""}return q[s.url]||(q[s.url]=s.url.replace(/[\/\.\?\&\:\=]/g,"_"))},fixIFrame:function(s){s=c(s);if(!s.length){return}if(s.get(0).tagName.toLowerCase()!="iframe"){s=s.find("iframe")}if(s.length>0){s.each(function(){this.src="javascript:false"})}},getIndexById:function(t){var s=-1;c.each(e.header,function(u){if(this.attr("id")==t){s=u;return false}});return s},headerClick:function(v){var u=v.target,s=u.tagName.toLowerCase(),t="active";if(c(u).hasClass("close")){t="remove"}if(s=="span"||s=="s"){u=c(u).parent("li").get(0)}if(u.tagName.toLowerCase()!="li"){return}t=="active"?this.activeTab(u.id):this.removeTab(this.getIndexById(u.id),true)}}})(jQuery);
